{% extends 'layout.html' %}
{% load static %}

{% block title %}{{ perfil.nombre_completo }} - OdontoLink{% endblock %}

{% block content %}
<div class="profile-detail-page">
    <!-- Columna Izquierda: Perfil Fijo -->
    <aside class="profile-sidebar-v2">
        <div class="sidebar-card">
            <img src="{% if perfil.foto_perfil %}{{ perfil.foto_perfil.url }}{% else %}{% static 'images/default-avatar.png' %}{% endif %}" alt="Foto de {{ perfil.nombre_completo }}" class="profile-photo-v2">
            <h1 class="profile-name-v2">{{ perfil.nombre_completo|default:perfil.user.username }}</h1>

            <div class="availability-badge-detail {% if perfil.disponible_para_citas %}available{% else %}unavailable{% endif %}">
                {% if perfil.disponible_para_citas %}
                    <i class="fas fa-calendar-check"></i> Disponible para citas
                {% else %}
                    <i class="fas fa-calendar-times"></i> No disponible para citas
                {% endif %}
            </div>
            
            <div class="profile-rating-v2">
                <i class="fas fa-star"></i>
                <span>{{ perfil.calificacion_promedio|default_if_none:"Sin calificación" }}</span>
            </div>

            <div class="profile-meta-v2">
                 <div class="meta-item-v2">
                    <i class="fas fa-graduation-cap"></i>
                    <span>{{ perfil.get_nivel_academico_display|default:'Nivel no especificado' }}</span>
                </div>
                {% if perfil.telefono_estudiante %}
                <div class="meta-item-v2">
                    <i class="fas fa-phone"></i>
                    <a href="tel:{{ perfil.telefono_estudiante }}">{{ perfil.telefono_estudiante }}</a>
                </div>
                {% endif %}
                {% if perfil.correo_profesional %}
                <div class="meta-item-v2">
                    <i class="fas fa-envelope"></i>
                    <a href="mailto:{{ perfil.correo_profesional }}">{{ perfil.correo_profesional }}</a>
                </div>
                {% endif %}
                {% if perfil.horarios_atencion %}
                <div class="meta-item-v2">
                    <i class="fas fa-clock"></i>
                    <span>{{ perfil.horarios_atencion }}</span>
                </div>
                {% endif %}
            </div>

            <!-- Botón de Verificación -->
            {% if perfil.carnet_de_estudiante %}
                <button id="verified-button" class="verified-badge clickable">
                    <i class="fas fa-shield-alt"></i>
                    <span>Estudiante Verificado</span>
                </button>
            {% else %}
                <div class="verified-badge-disabled">
                    <i class="fas fa-shield-alt"></i>
                    <span>Estudiante no Verificado</span>
                </div>
            {% endif %}
        </div>
    </aside>

    <!-- Columna Derecha: Contenido Principal -->
    <main class="profile-content-v2">
        <section class="content-card-v2">
            <h2>Sobre Mí</h2>
            <p>{{ perfil.sobre_mi|default:"Este estudiante aún no ha añadido una descripción."|linebreaksbr }}</p>
        </section>

        <section class="content-card-v2">
            <h2>Servicios Ofrecidos</h2>
            <div class="services-list-v2">
                {% for oferta in ofertas %}
                <div class="service-item-v2">
                    <div class="service-details">
                        <h3 class="service-title">{{ oferta.titulo }}</h3>
                        <p class="service-description">{{ oferta.descripcion }}</p>
                    </div>
                    <div class="service-price-action">
                        <span class="service-price">${{ oferta.precio|floatformat:0 }}</span>
                        <a href="#" class="btn btn-secondary">Ver</a>
                    </div>
                </div>
                {% empty %}
                <p class="text-muted">Este estudiante no tiene ninguna oferta activa en este momento.</p>
                {% endfor %}
            </div>
        </section>
    </main>
</div>

<!-- Modal para el Carnet de Estudiante -->
{% if perfil.carnet_de_estudiante %}
<div id="credential-modal" class="modal-overlay">
    <div class="modal-content">
        <span class="modal-close">&times;</span>
        <h3 class="modal-title">Carnet de Estudiante Verificado</h3>
        <img src="{{ perfil.carnet_de_estudiante.url }}" alt="Carnet de {{ perfil.nombre_completo }}" class="modal-image">
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const modal = document.getElementById('credential-modal');
        const btn = document.getElementById('verified-button');
        const span = document.getElementsByClassName('modal-close')[0];

        if (btn) {
            btn.onclick = function() {
                modal.style.display = "block";
            }
        }

        if (span) {
            span.onclick = function() {
                modal.style.display = "none";
            }
        }

        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
            }
        }
    });
</script>
{% endif %}

{% endblock %}
